<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PartyGame - TV Host</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        /* Lock toggle styles */
        .lock-toggle {
            display: flex;
            align-items: center;
            gap: var(--gap);
            padding: var(--gap) var(--gap-lg);
            background: var(--bg-color);
            border-radius: var(--radius-lg);
            margin-top: var(--gap);
        }
        
        .lock-toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            background: #ccc;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }
        
        html.tv-mode .lock-toggle-switch {
            width: clamp(52px, min(4vw, 7vh), 72px);
            height: clamp(28px, min(2.2vw, 4vh), 40px);
            border-radius: clamp(14px, min(1.1vw, 2vh), 20px);
        }
        
        .lock-toggle-switch.locked {
            background: var(--warning-color);
        }
        
        .lock-toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        html.tv-mode .lock-toggle-switch::after {
            width: clamp(24px, min(1.9vw, 3.4vh), 36px);
            height: clamp(24px, min(1.9vw, 3.4vh), 36px);
        }
        
        .lock-toggle-switch.locked::after {
            transform: translateX(24px);
        }
        
        html.tv-mode .lock-toggle-switch.locked::after {
            transform: translateX(clamp(24px, min(1.9vw, 3.4vh), 32px));
        }
        
        .lock-toggle-label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            font-size: var(--font-base);
        }
        
        .lock-toggle-label .icon {
            font-size: var(--font-lg);
        }
        
        .lock-status {
            font-size: var(--font-sm);
            color: var(--text-light);
        }
        
        .lock-status.locked {
            color: var(--warning-color);
        }
        
        /* Game Status Overlay */
        .game-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .game-overlay.visible {
            display: flex;
        }
        
        .game-overlay-content {
            text-align: center;
            color: white;
        }
        
        .game-overlay-icon {
            font-size: 4rem;
            margin-bottom: 24px;
        }
        
        html.tv-mode .game-overlay-icon {
            font-size: var(--font-4xl);
            margin-bottom: var(--gap-xl);
        }
        
        .game-overlay-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 16px;
        }
        
        html.tv-mode .game-overlay-title {
            font-size: var(--font-3xl);
            margin-bottom: var(--gap);
        }
        
        .game-overlay-subtitle {
            font-size: 1.25rem;
            opacity: 0.8;
        }
        
        html.tv-mode .game-overlay-subtitle {
            font-size: var(--font-xl);
        }

        /* Game Status Card */
        .game-status-card {
            display: none;
            background: var(--success-color);
            color: white;
            padding: var(--gap) var(--gap-lg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--gap);
        }
        
        .game-status-card.visible {
            display: block;
        }
        
        .game-status-card .status-icon {
            font-size: var(--font-xl);
        }
        
        .game-status-card .status-title {
            font-weight: bold;
            font-size: var(--font-lg);
        }
        
        .game-status-card .status-info {
            opacity: 0.9;
            font-size: var(--font-sm);
        }

        /* DEV Panel styles */
        .dev-panel {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #f97316;
            border-radius: var(--radius-lg);
            padding: var(--gap);
            margin-bottom: var(--gap);
            display: none;
        }

        .dev-panel.visible {
            display: block;
        }

        .dev-panel.hidden-by-user {
            display: none !important;
        }

        .dev-panel-header {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            margin-bottom: var(--gap);
        }

        .dev-badge {
            background: #f97316;
            color: white;
            padding: var(--gap-xs) var(--gap-sm);
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: var(--font-xs);
            letter-spacing: 0.5px;
        }

        .dev-panel-title {
            color: white;
            font-weight: 600;
            font-size: var(--font-sm);
        }

        .dev-panel-controls {
            display: flex;
            flex-wrap: wrap;
            gap: var(--gap-sm);
            margin-bottom: var(--gap-sm);
        }

        .dev-panel button {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius);
            padding: var(--gap-sm) var(--gap);
            cursor: pointer;
            font-weight: 600;
            font-size: var(--font-sm);
            transition: all 0.2s;
        }

        .dev-panel button:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.4);
        }

        .dev-panel button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dev-panel .status-text {
            color: rgba(255,255,255,0.8);
            font-size: var(--font-xs);
        }

        .hide-devtools-btn {
            background: rgba(255,100,100,0.2) !important;
            border-color: rgba(255,100,100,0.3) !important;
            margin-left: auto;
        }

        .hide-devtools-btn:hover {
            background: rgba(255,100,100,0.3) !important;
        }

    </style>
</head>
<body>
    <div class="tv-layout">
        <!-- Main Content -->
        <div class="tv-main">
            <div class="tv-header">
                <h1>üéÆ PartyGame</h1>
                <p id="headerSubtitle">Scan the QR code or enter the room code to join!</p>
            </div>

            <!-- Connection Status -->
            <div id="connectionStatus" class="status status-connecting" style="align-self: flex-start; margin-bottom: var(--gap);">
                <span class="status-dot"></span>
                <span id="statusText">Connecting...</span>
            </div>

            <!-- DEV Panel for Bots -->
            <div id="devPanel" class="dev-panel">
                <div class="dev-panel-header">
                    <span class="dev-badge">DEV</span>
                    <span class="dev-panel-title">Server-side Bots (Autoplay)</span>
                    <button id="hideDevtoolsBtn" class="hide-devtools-btn" title="Hide devtools for this session">üëÅÔ∏è Hide devtools</button>
                </div>
                <div class="dev-panel-controls">
                    <button id="addBotsBtn">ü§ñ Add Bots</button>
                    <button id="startAutoplayBtn">‚ñ∂Ô∏è Start Autoplay</button>
                    <button id="stopAutoplayBtn">‚èπÔ∏è Stop Autoplay</button>
                </div>
                <div class="status-text" id="autoplayStatus">Autoplay: stopped ¬∑ Bots: 0</div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="error-message card"></div>

            <!-- Loading State -->
            <div id="loadingState" class="card" style="text-align: center; padding: var(--gap-xl);">
                <div class="spinner" style="margin: 0 auto var(--gap-lg);"></div>
                <p>Creating room...</p>
            </div>

            <!-- Room Info Card -->
            <div id="roomCard" class="card" style="display: none;">
                <div style="text-align: center;">
                    <p style="color: var(--text-light); margin-bottom: var(--gap-sm); font-size: var(--font-base);">ROOM CODE</p>
                    <div class="room-code" id="roomCode">----</div>
                    <p style="color: var(--text-light); font-size: var(--font-base);">
                        Join at: <strong id="joinUrl"></strong>
                    </p>
                </div>
                
                <!-- Room Lock Toggle -->
                <div class="lock-toggle">
                    <div id="lockSwitch" class="lock-toggle-switch" onclick="toggleRoomLock()"></div>
                    <div>
                        <div class="lock-toggle-label">
                            <span class="icon" id="lockIcon">üîì</span>
                            <span id="lockLabel">Room Open</span>
                        </div>
                        <div id="lockStatus" class="lock-status">New players can join</div>
                    </div>
                </div>
            </div>

            <!-- QR Code Card -->
            <div id="qrCard" class="card qr-container" style="display: none;">
                <div class="qr-code">
                    <img id="qrCodeImage" alt="QR Code">
                </div>
                <p class="qr-hint">Scan with your phone camera to join</p>
            </div>

            <!-- Game Status Card (shown when game is in progress) -->
            <div id="gameStatusCard" class="game-status-card">
                <div style="display: flex; align-items: center; gap: var(--gap);">
                    <span class="status-icon">üéØ</span>
                    <div>
                        <div class="status-title">Game In Progress</div>
                        <div class="status-info">
                            <span id="gameTypeDisplay">Quiz</span> - <span id="gamePhaseDisplay">Starting</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar: Player List -->
        <div class="tv-sidebar">
            <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                <h2 style="margin-bottom: var(--gap); display: flex; align-items: center; justify-content: space-between; font-size: var(--font-xl);">
                    Players
                    <span id="playerCount" class="player-count-badge" style="background: var(--bg-color); padding: var(--gap-xs) var(--gap); border-radius: 20px; font-size: var(--font-sm);">0/8</span>
                </h2>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <p class="empty-state-text">Waiting for players to join...</p>
                </div>

                <!-- Player List -->
                <ul id="playerList" class="player-list" style="display: none;"></ul>

                <!-- Start Game Button -->
                <div id="startGameContainer" style="margin-top: auto; padding-top: var(--gap-lg);">
                    <button id="startGameBtn" class="btn btn-success btn-large" style="width: 100%;" disabled>
                        Start Game
                    </button>
                    <p id="startGameHint" style="text-align: center; margin-top: var(--gap-sm); color: var(--text-light); font-size: var(--font-sm);">
                        Need at least 2 players to start
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Starting Overlay -->
    <div id="gameOverlay" class="game-overlay">
        <div class="game-overlay-content">
            <div class="game-overlay-icon">üéÆ</div>
            <div class="game-overlay-title">Game Starting!</div>
            <div class="game-overlay-subtitle">Get ready, <span id="overlayPlayerCount">0</span> players...</div>
        </div>
    </div>

    <!-- SignalR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/game-client.js"></script>
    <script>
        // ===========================================
        // TV MODE DETECTION
        // Automatically add 'tv-mode' class for large screens
        // ===========================================
        function updateTvMode() {
            const isTvMode = window.innerWidth >= 1200;
            document.documentElement.classList.toggle('tv-mode', isTvMode);
            console.log(`TV Mode: ${isTvMode ? 'enabled' : 'disabled'} (width: ${window.innerWidth}px)`);
        }
        
        // Initialize and listen for resize
        window.addEventListener('resize', updateTvMode);
        updateTvMode();

        // ===========================================
        // GAME CLIENT LOGIC
        // ===========================================
        
        // Get server URL from config
        const SERVER_URL = GameConfig.getServerUrl();
        console.log('Using Server URL:', SERVER_URL || '(same origin)');
        
        // Check for room code in URL (for returning from game)
        const urlParams = new URLSearchParams(window.location.search);
        const existingRoomCode = urlParams.get('room');
        
        // DOM Elements
        const connectionStatus = document.getElementById('connectionStatus');
        const statusText = document.getElementById('statusText');
        const errorMessage = document.getElementById('errorMessage');
        const loadingState = document.getElementById('loadingState');
        const roomCard = document.getElementById('roomCard');
        const qrCard = document.getElementById('qrCard');
        const roomCodeEl = document.getElementById('roomCode');
        const joinUrlEl = document.getElementById('joinUrl');
        const qrCodeImage = document.getElementById('qrCodeImage');
        const playerCount = document.getElementById('playerCount');
        const emptyState = document.getElementById('emptyState');
        const playerList = document.getElementById('playerList');
        const startGameBtn = document.getElementById('startGameBtn');
        const lockSwitch = document.getElementById('lockSwitch');
        const lockIcon = document.getElementById('lockIcon');
        const lockLabel = document.getElementById('lockLabel');
        const lockStatusEl = document.getElementById('lockStatus');
        const gameStatusCard = document.getElementById('gameStatusCard');
        const gameTypeDisplay = document.getElementById('gameTypeDisplay');
        const gamePhaseDisplay = document.getElementById('gamePhaseDisplay');
        const headerSubtitle = document.getElementById('headerSubtitle');
        const gameOverlay = document.getElementById('gameOverlay');
        const overlayPlayerCount = document.getElementById('overlayPlayerCount');
        const startGameContainer = document.getElementById('startGameContainer');
        const startGameHint = document.getElementById('startGameHint');
        
        // DEV Panel elements
        const devPanel = document.getElementById('devPanel');
        const addBotsBtn = document.getElementById('addBotsBtn');
        const startAutoplayBtn = document.getElementById('startAutoplayBtn');
        const stopAutoplayBtn = document.getElementById('stopAutoplayBtn');
        const autoplayStatusEl = document.getElementById('autoplayStatus');
        const hideDevtoolsBtn = document.getElementById('hideDevtoolsBtn');

        // Game client
        const client = new GameClient(SERVER_URL);
        let currentRoomCode = null;
        let isRoomLocked = false;
        let currentRoomStatus = 'Lobby';

        // Initialize
        async function init() {
            try {
                client.on('onConnected', onConnected);
                client.on('onDisconnected', onDisconnected);
                client.on('onReconnecting', onReconnecting);
                client.on('onLobbyUpdated', onLobbyUpdated);
                client.on('onGameStarted', onGameStarted);
                client.on('onAutoplayStatusUpdated', onAutoplayStatusUpdated);
                client.on('onError', onError);

                await client.connect();

                if (existingRoomCode) {
                    await rejoinExistingRoom(existingRoomCode);
                } else {
                    await createAndJoinRoom();
                }
                
                await configureDevPanel();

            } catch (error) {
                console.error('Initialization failed:', error);
                showError('Failed to initialize. Please refresh the page.');
            }
        }

        async function rejoinExistingRoom(roomCode) {
            try {
                loadingState.querySelector('p').textContent = 'Reconnecting to room...';
                
                const roomState = await GameUtils.getRoomState(SERVER_URL, roomCode);
                
                if (!roomState) {
                    console.log('Room not found, creating new room');
                    loadingState.querySelector('p').textContent = 'Creating new room...';
                    await createAndJoinRoom();
                    return;
                }
                
                currentRoomCode = roomCode;
                await client.registerHost(currentRoomCode);
                showRoomInfo(currentRoomCode);
                
                console.log('Rejoined existing room:', roomCode);

            } catch (error) {
                console.error('Failed to rejoin room:', error);
                await createAndJoinRoom();
            }
        }

        async function createAndJoinRoom() {
            try {
                const roomData = await GameUtils.createRoom(SERVER_URL);
                currentRoomCode = roomData.roomCode;
                await client.registerHost(currentRoomCode);
                showRoomInfo(currentRoomCode);

            } catch (error) {
                console.error('Failed to create room:', error);
                showError('Failed to create room. Please refresh the page.');
            }
        }

        function showRoomInfo(code) {
            loadingState.style.display = 'none';
            roomCard.style.display = 'block';
            qrCard.style.display = 'flex';

            roomCodeEl.textContent = code;
            
            const joinUrl = `${GameConfig.getJoinBaseUrl()}/join/${code}`;
            joinUrlEl.textContent = joinUrl;
            
            // Dynamic QR code size based on viewport
            const qrSize = Math.min(280, Math.max(160, Math.floor(window.innerWidth * 0.12)));
            qrCodeImage.src = GameUtils.getQRCodeUrl(joinUrl, qrSize);
        }

        function updateLockUI(locked) {
            isRoomLocked = locked;
            
            if (locked) {
                lockSwitch.classList.add('locked');
                lockIcon.textContent = 'üîí';
                lockLabel.textContent = 'Room Locked';
                lockStatusEl.textContent = 'No new players can join';
                lockStatusEl.classList.add('locked');
            } else {
                lockSwitch.classList.remove('locked');
                lockIcon.textContent = 'üîì';
                lockLabel.textContent = 'Room Open';
                lockStatusEl.textContent = 'New players can join';
                lockStatusEl.classList.remove('locked');
            }
        }

        async function toggleRoomLock() {
            try {
                await client.setRoomLocked(!isRoomLocked);
            } catch (error) {
                console.error('Failed to toggle room lock:', error);
                showError('Failed to change room lock state.');
            }
        }

        function onConnected() {
            connectionStatus.className = 'status status-connected';
            statusText.textContent = 'Connected';
        }

        function onDisconnected() {
            connectionStatus.className = 'status status-disconnected';
            statusText.textContent = 'Disconnected';
        }

        function onReconnecting() {
            connectionStatus.className = 'status status-connecting';
            statusText.textContent = 'Reconnecting...';
        }

        function onLobbyUpdated(roomState) {
            console.log('Lobby updated:', roomState);
            
            const players = roomState.players || [];
            const maxPlayers = 8;

            playerCount.textContent = `${players.length}/${maxPlayers}`;
            updateLockUI(roomState.isLocked);
            currentRoomStatus = roomState.status;
            updateGameStatusUI(roomState);

            if (players.length === 0) {
                emptyState.style.display = 'block';
                playerList.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                playerList.style.display = 'block';
                
                playerList.innerHTML = players.map(player => `
                    <li class="player-item fade-in">
                        <div class="player-info">
                            <div class="player-avatar">
                                <img src="${getPlayerAvatarSrc(player)}" 
                                     alt="${escapeHtml(player.displayName)}"
                                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <span style="display: none;">${GameUtils.getInitials(player.displayName)}</span>
                            </div>
                            <div>
                                <div class="player-name">${escapeHtml(player.displayName)}</div>
                                <div class="player-status ${player.isConnected ? 'connected' : 'disconnected'}">
                                    ${player.isConnected ? '‚óè Connected' : '‚óã Disconnected'}
                                </div>
                            </div>
                        </div>
                    </li>
                `).join('');
            }

            const isLobby = currentRoomStatus === 'Lobby' || currentRoomStatus === 0;
            const canStart = players.length >= 2 && isLobby;
            startGameBtn.disabled = !canStart;
            
            if (!isLobby) {
                startGameHint.textContent = 'Game is in progress';
            } else if (players.length < 2) {
                startGameHint.textContent = 'Need at least 2 players to start';
            } else {
                startGameHint.textContent = 'Ready to start!';
            }

            hideError();
        }

        function onGameStarted(gameSession) {
            console.log('Game started:', gameSession);
            
            overlayPlayerCount.textContent = playerCount.textContent.split('/')[0];
            gameOverlay.classList.add('visible');
            
            if (gameSession.gameType === 'Quiz') {
                setTimeout(() => {
                    window.location.href = `/quiz-tv.html?room=${currentRoomCode}`;
                }, 2000);
            }
        }

        function updateGameStatusUI(roomState) {
            if (roomState.status === 'InGame' || roomState.status === 1) {
                gameStatusCard.classList.add('visible');
                headerSubtitle.textContent = 'Game in progress!';
                startGameContainer.style.display = 'none';
                
                if (roomState.currentGame) {
                    gameTypeDisplay.textContent = roomState.currentGame.gameType || 'Quiz';
                    gamePhaseDisplay.textContent = roomState.currentGame.phase || 'Starting';
                }
            } else {
                gameStatusCard.classList.remove('visible');
                headerSubtitle.textContent = 'Scan the QR code or enter the room code to join!';
                startGameContainer.style.display = 'block';
            }
        }
        
        async function configureDevPanel() {
            try {
                const response = await fetch(`${SERVER_URL}/health`);
                const data = await response.json();
                if (data?.environment === 'Development') {
                    // Check if devtools should be hidden (user preference)
                    const hideDevtools = localStorage.getItem('hideDevtools') === 'true';
                    
                    if (!hideDevtools) {
                        devPanel.classList.add('visible');
                        setupDevPanelListeners();
                    } else {
                        devPanel.classList.add('hidden-by-user');
                    }
                }
            } catch (error) {
                console.warn('DEV panel check failed:', error);
            }
        }
        
        function setupDevPanelListeners() {
            // Hide devtools button
            document.getElementById('hideDevtoolsBtn').addEventListener('click', () => {
                localStorage.setItem('hideDevtools', 'true');
                devPanel.classList.remove('visible');
                devPanel.classList.add('hidden-by-user');
                console.log('Devtools hidden - refresh or clear localStorage to show again');
            });

            addBotsBtn.addEventListener('click', async () => {
                try {
                    addBotsBtn.disabled = true;
                    await client.addBots();
                } catch (error) {
                    console.error('Failed to add bots:', error);
                    showError('Failed to add bots: ' + (error.message || 'Unknown error'));
                } finally {
                    addBotsBtn.disabled = false;
                }
            });

            startAutoplayBtn.addEventListener('click', async () => {
                try {
                    startAutoplayBtn.disabled = true;
                    await client.startAutoplay();
                } catch (error) {
                    console.error('Failed to start autoplay:', error);
                    showError('Failed to start autoplay: ' + (error.message || 'Unknown error'));
                } finally {
                    startAutoplayBtn.disabled = false;
                }
            });

            stopAutoplayBtn.addEventListener('click', async () => {
                try {
                    stopAutoplayBtn.disabled = true;
                    await client.stopAutoplay();
                } catch (error) {
                    console.error('Failed to stop autoplay:', error);
                    showError('Failed to stop autoplay: ' + (error.message || 'Unknown error'));
                } finally {
                    stopAutoplayBtn.disabled = false;
                }
            });
        }
        
        function onAutoplayStatusUpdated(status) {
            if (!status || !autoplayStatusEl) return;
            const running = status.running ? 'running' : 'stopped';
            autoplayStatusEl.textContent = `Autoplay: ${running} ¬∑ Bots: ${status.botCount ?? 0}`;
        }

        startGameBtn.addEventListener('click', async () => {
            if (startGameBtn.disabled) return;
            
            try {
                startGameBtn.disabled = true;
                startGameBtn.textContent = 'Starting...';
                
                await client.startGame('Quiz');
                
            } catch (error) {
                console.error('Failed to start game:', error);
                showError('Failed to start game: ' + (error.message || 'Unknown error'));
                startGameBtn.disabled = false;
                startGameBtn.textContent = 'Start Game';
            }
        });

        function onError(error) {
            showError(GameUtils.formatError(error));
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('visible');
        }

        function hideError() {
            errorMessage.classList.remove('visible');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * Get avatar source URL for a player (same as quiz-tv.html)
         */
        function getPlayerAvatarSrc(player) {
            // AvatarKind: 0 = Preset, 1 = Uploaded
            if (player.avatarKind === 0 && player.avatarPresetId) {
                // Preset avatar - use SVG from assets
                return `/assets/avatars/jelly/${player.avatarPresetId}.svg`;
            } else if (player.avatarKind === 1 && player.avatarUrl) {
                // Uploaded avatar - use URL
                return player.avatarUrl;
            } else {
                // Fallback - use colored circle with initials (data URI)
                const initials = GameUtils.getInitials(player.displayName);
                const colors = [
                    '#e74c3c', '#3498db', '#2ecc71', '#f39c12', 
                    '#9b59b6', '#1abc9c', '#e67e22', '#16a085'
                ];
                const color = colors[Math.abs(hashCode(player.playerId)) % colors.length];
                
                return `data:image/svg+xml,${encodeURIComponent(`
                    <svg width="96" height="96" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="48" cy="48" r="48" fill="${color}"/>
                        <text x="48" y="64" font-size="36" fill="white" text-anchor="middle" font-weight="bold" font-family="Arial">${initials}</text>
                    </svg>
                `)}`;
            }
        }

        /**
         * Simple hash function for consistent color assignment
         */
        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0;
            }
            return hash;
        }

        init();

    </script>
</body>
</html>
